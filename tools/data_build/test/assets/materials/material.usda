#usda 1.0

def Material "Material" (
    prepend apiSchemas = ["RainMaterialAPI"]
) {
    # Actual asset stuffs!
    uniform asset rn:shader = @../material_shaders/material_shader.usda@
    rel rn:parameters = [
        </Material/Param/ColorTexture>,
        </Material/Param/Color>
    ]

    def Scope "Param"
    {
        def MaterialParamTexture "ColorTexture"
        {
            uniform asset texture = @../textures/texture.usda@
        }

        def MaterialParamFloatVec "Color"
        {
            uniform float[] value = [0.5, 0.5, 0.5, 1.0]
        }
    }

    # Preview shader stuffs!
    token inputs:frame:stPrimvarName = "st"
    token outputs:surface.connect = </Material/PreviewShader.outputs:surface>

    def Shader "PreviewShader"
    {
        uniform token info:id = "UsdPreviewSurface"
        color3f inputs:diffuseColor.connect = </Material/PreviewTexture.outputs:rgb>
        float inputs:metallic = 0
        float inputs:roughness = 0.4
        token outputs:surface
    }

    def Shader "PreviewSTReader"
    {
        uniform token info:id = "UsdPrimvarReader_float2"
        string inputs:varname.connect = </Material.inputs:frame:stPrimvarName>
        float2 outputs:result
    }

    def Shader "PreviewTexture"
    {
        uniform token info:id = "UsdUVTexture"
        asset inputs:file.connect = </Material/Param/ColorTexture.texture>
        float2 inputs:st.connect = </Material/PreviewSTReader.outputs:result>
        token inputs:wrapS = "repeat"
        token inputs:wrapT = "repeat"
        float3 outputs:rgb
    }
}